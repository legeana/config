#!/bin/sh -e

log() {
    echo "$@" >&2
}

fatal() {
    log "$@"
    exit 1
}

get_rust() {
    if cargo --version >/dev/null 2>&1; then
        log "Using existing cargo"
        return
    fi
    # Use https://rustup.rs/ as package managers often don't have new enough
    # rust toolchain.
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
}

get_rust
cargo run --manifest-path="$(dirname "$0")/Cargo.toml" --release -- "$@"
