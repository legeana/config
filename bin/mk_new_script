#!/bin/sh
D_PATH="/usr/local/bin/"
PROGRAM="/bin/sh"
while getopts "p:gcib" arg
do
	case "$arg" in
		p) PROGRAM="$OPTARG";;
		c) ADDITION="# -*- coding: utf-8 -*-\n"
			PROGRAM="python";;
		g) ADDITION='while getopts "p:h" arg\ndo\n\tcase "$arg" in\n\t\tp) P="$OPTARG";;\n\t\th) ;;&\n\t\t?) printf "Usage: %s: [-p p [default]] param_descr\\n" "$0" 1>&2 && exit 1;;\n\tesac\ndone\nshift "$(echo "$OPTIND" - 1 | bc)"\n';;
		i) INIT="";;
		b) BUSYBOX="$(which busybox)";;
		?) printf "Usage: %s: [-p #!text] [-c coding string for python] [-g [useful only for *sh]] [-i [makes default init script for initramfs]] [-b [busybox function rather then real program]] path\n" "$0" 1>&2 && exit 1;;
	esac
done
shift "$(echo "$OPTIND" - 1 | bc)"

NAME="$1"

echo "$NAME" | egrep '^[^/]*$' >/dev/null 2>&1 && NAME="${D_PATH}${NAME}"
if echo "$PROGRAM" | egrep '^[^/]*$' >/dev/null 2>&1; then
	PROGRAM="$([ "$BUSYBOX" ] && echo "$BUSYBOX $PROGRAM" || which "$PROGRAM" )"
fi
(echo "#!$PROGRAM" && [ "$INIT" ] && echo "$INIT" || [ "$ADDITION" ] && echo -e "$ADDITION" || true ) > "$NAME"
chmod +x "$NAME"

